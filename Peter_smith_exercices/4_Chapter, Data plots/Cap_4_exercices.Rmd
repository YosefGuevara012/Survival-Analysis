---
title: "Chapter 4. Data Plots Peter smith"
output: html_notebook
---
```{r}

knitr::include_graphics("4_1.PNG")

```

#### Required data

```{r}

## Months in office for Australian Prime Ministers

ministers <- c(seq(1:29))
months <- c(33,8,5,12,41,8,11,39,16,14,89,81,28,88,1,29,3,46,1,54,194,24,2,39,22,36,89,106,52)

```

#### Plotting position calculations

```{r}
## Plotting position

p <- (ministers - 0.5)/length(ministers)
head(p)
```

#### Data Plot

```{r}
## Empirical survivor plot

months <- sort(months)
data <- as.data.frame(cbind(months,1-p))
plot(months,1-p, main="Empirical Survival Function", xlab = "Months in office", ylab = "Survival Probability")

```
#### Estimate probablity of survival beyond full 3 years 

Knowing that the estimate probability of the survival fucntion is giving by

$$S_n\left(y\right)=\frac{number\:of\:observations\:>y}{n}=\frac{1}{n}\sum _{i=1}^n\:I\left(y,\infty \right)\left(Y_i\right)$$

then:

$$S_{29}\left(17\right)=\frac{1}{29}\sum _{i=1}^n\:I\left(12,\infty \right)\left(Y_i\right)=\frac{12}{29}\:=\:0.4137$$
#### Confidence interval

And the approximate confidence interval based in two standard error is:

$$S_{29}\left(17\right)\frac{+}{ }2\sqrt{\frac{S_{29}\left(12\right)\left(1-S_{29}\left(12\right)\right)}{n}}$$

then

$$0.4137+2\sqrt{\frac{0.4137\left(1-0.4137\right)}{29}}=0.5966$$


and

$$0.4137-2\sqrt{\frac{0.4137\left(1-0.4137\right)}{29}}=0.2308$$

```{r}

knitr::include_graphics("4_2.PNG")

```

#### Required data

```{r}
## Stanford Heart Transplat Data

## Reading data
heart <- read.csv("heart_data.csv", header=T,sep=";")
head(heart)

```
#### Cleaning the censored data

```{r}

heart_cens <- subset(heart, Cens == 1)
attach(heart_cens)
heart_cens
```


#### Plotting position calculations

```{r}

## Plotting position

patients <- seq(1:length(Days))
p <- (patients - 0.5)/length(patients)
head(p)

```

#### Data Plot

```{r}
## Empirical survivor plot

Days <- sort(Days)
plot(Days,1-p, main="Empirical Survival Function", xlab = "
Days since heart transplant", ylab = "Survival Probability")

```

#### Estimate probablity of survival beyond full 3 years 

```{r}
## Looking on the data greater than 1000

sum(Days > 1000)

```

Then by the definition 1.3:

$$S_{45}\left(43\right)=\frac{1}{45}\sum \:_{i=1}^{45}\:I\left(2,\infty \:\right)\left(Y_i\right)=\frac{2}{45}=0.0444$$
#### Confidence interval

The approximate confidence interval based in two standard error is:

$$0.4444+2\sqrt{\frac{0.4444\left(1-0.4444\right)}{45}}=0.5925$$
and

$$0.4444-2\sqrt{\frac{0.4444\left(1-0.4444\right)}{45}}=0.2962$$
```{r}

knitr::include_graphics("4_3.PNG")

```
The defitnion 4.6 says that the hazard plot is given by:

$$\left(\alpha _i,y_{\left(j\right)}\right)$$

Where

$$\alpha _j=\sum \:_{i=1}^j\left(\frac{1}{n-i+1}\right)$$
```{r}
alpha <-c()
sumatory <- c()

for(j in 1:length(Days)){
  
  for(i in 1:j){
    
    sumatory[i]<- (1/(length(Days)-i+1))
    
  }
  alpha[j]<- sum(sumatory)
  sumatory <- 0
}

```



```{r}

plot(Days,alpha, main="Hazard Plot", xlab = "
Days since heart transplant", ylab = "Hazard plot score")
```

```{r}

knitr::include_graphics("4_3_1.PNG")

```
knowing that

$$H_{n\left(y\right)}=-ln\left(S_n\left(y\right)\right)$$
We have that:

$$ H_{45}\left(43\right)=-ln\left(0.0444\right)=3.1145$$


```{r}

knitr::include_graphics("4_3_2.PNG")

```

